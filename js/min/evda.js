function EvDa(H){function I(a,b){return a.match(/[?*]/)?C(t(b?b:e),function(b){return b.match(a)}):a}function D(a,b){var d={};return g(a)?(f(a,function(c){d[a]=b(a)}),d):b(a)}function c(a,b,d){if(0===arguments.length)return{data:e,setters:p,events:k,globs:y};if(g(a)){var u=l.call(arguments,1);return J(a,function(a){return c.apply(c.context,[a].concat(u))})}if(1==arguments.length){if(v(a)){var r={};f(a,function(a,b){r[a]=c(a,b,d,0,1)});f(r,function(b,d){m(r[b])&&!m(a[b])&&(a[b]=r[b]())});E(t(r)[0]);
return a}return D(a,function(a){return e[a]})}return c[m(b)?"on":"set"].apply(this,arguments)}function z(a){f(a.$,function(b){var d=b.match(/[?*]/)?y:k;d[b]=F(d[b],a)})}function n(a,b,d){if(g(a)){var u=a.pop();return n(I(u),function(d,c){return n(1==a.length?a[0]:a,b,c)},d)}if(v(a))return f(a,function(b,c){b.match(/[?*]/)?q(b,D(b,function(a){return n(b,c,d)})):a[b]=n(b,c,d)}),a;p[a]&&(p[a](function(b){c.set.call(c.context,a,b,d)}),delete p[a]);return b?a in e?b.call(c.context,e[a],d):c(a,b,q(d||{},
G)):a in e}function E(a){var b=a.split("."),d=b.pop();parts_obj=[];parts_obj[d]=e[a];c.extend.apply(c.context,[b.join("."),parts_obj].concat(l.call(arguments,1)))}var l=Array.prototype.slice,x=Object.prototype.toString,g=[].isArray||function(a){return"[object Array]"===x.call(a)},m=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},A=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},v=function(a){return m(a)||A(a)||"[object Number]"===x.call(a)||g(a)?!1:null==a?"object"==String(a):"[object Object]"===
x.call(a)||!0},f=[].forEach?function(a,b){if(g(a)||a.length)l.call(a).forEach(b);else for(var d in a)b(d,a[d])}:function(a,b){if(g(a))for(var d=0,c=a.length;d<c;d++)b(a[d],d);else for(d in a)b(d,a[d])},t={}.keys||function(a){if(g(a))return a;var b=[],d;for(d in a)b.push(d);return b},F=function(a,b){var d=[];f(a,function(a){a!==b&&d.push(a)});return d},K=function(a){var b,d=[];f(t(a).sort(),function(a){a!=b&&(b=a,d.push(a))});return d},C=function(a,b){var d=[];f(a,function(a){b(a)&&d.push(a)});return d},
w=function(a){return a&&"length"in a?a.length:0},J=[].map?function(a,b){return a.map(b)}:function(a,b){for(var d=[],c=0,e=a.length;c<e;c++)d.push(b(a[c],c));return d},L=function(a){return g(a)?l.call(a):v(a)?q(a,{}):a},q=function(a){f(l.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(v(b[c])&&v(a[c])?q(a[c],b[c]):a[c]=b[c])});return a},G={once:1},e=H||{},B=[],p={},y={},k={};f(["first","on","after","test","or"],function(a){c[a]=function(b,c,e){var f=k;c||(c=b,b="__base");(c.$||(c.$=[])).push(a+
b);b.match(/[?*]/)&&(f=y);(f[a+b]||(f[a+b]=[])).push(c);return q(c,e)}});q(c,{_:{},context:this,list:{},isPaused:!1,db:e,setterMap:p,events:k,del:z,whenSet:n,isset:n,pause:function(){return c.isPaused?!1:(c.isPaused=!0,c._.set=c.set,c.set=function(){B.push(["set",arguments])},!0)},play:function(){if(c.isPaused){c.isPaused=!1;var a=EvDa();c.set=c._.set;f(B,function(b){a[b[0]].apply(a,b[1])});B=[];c(a.db);return!0}return!1},setter:function(a,b){p[a]=b;if(k["on"+a])return n(a)},when:function(a,b,d){if(A(b))try{var e=
new Function("x","return x"+b);e();b=e}catch(f){}return c(a,function(a){(g(b)&&b.sort().join("")===a.sort().join("")||m(b)&&b(a)||a===b)&&d.call(c.context,a)})},empty:function(){for(var a in e)delete e[a]},incr:function(a,b){b=b||1;return c.set(a,"[object Number]"===x.call(e[a])?e[a]+b:b)},decr:function(a,b){return c.set(a,e[a]-(b||1)||0)},push:function(a,b){1==w(arguments)&&(b=a,a="__base");return c.set(a,[].concat(e[a]||[],[b]))},pop:function(a){return c.set(a||"__base",e[a].slice(0,-1))},traceList:[],
group:function(a){var b=l.call(arguments);a=b.shift();b=c.apply(0,b);c.list[a]||(c.list[a]=[]);m(b)?c.list[a].push(b):f(b,function(b,e){c.list[a].push(b)});return function(){return c.group.apply(0,[a].concat(l.call(arguments)))}},extend:function(a,b){return c.set.apply(c.context,[a,q({},e[a]||{},b)].concat(l.call(arguments,2)))},set:function(a,b,d,u,r){var h="test"+a,g=l.call(arguments),n=w(k[h]),p=n&&!u,m,s=p?function(e){m|=!1===e;--n||(m?f(k["or"+a]||[],function(a){a.S||(a.call(c.context,b,d),a.once&&
z(a))}):c.set(a,b,d,1));return e}:{};s.old=L(e[a]);q(s,{meta:d||{},done:s,result:s,key:a});p?(f(k[h],function(a){a.call(c.context,b,s)}),h=e[a]):(f(c.traceList,function(a){a.call(c.context,g)}),e[a]=b,h=function(){f((k["first"+a]||[]).concat(k["on"+a]||[],k["after"+a]||[]),function(a){a.S||(a.call(c.context,b,s),a.once&&z(a));s.last=void 0});return b},h=r?h:h.call(c.context));0<a.length&&E.apply(c.context,[a].concat(l.call(arguments,2)));return h},fire:function(a){c.set(a,e[a])},once:function(a,b,
d){return b?c.once(c(a,b,d)):q(a,G)},enable:function(a){f(c.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==w(b.S)&&delete b.S});return c.list[a]},setadd:function(a,b){b=g(b)?b:[b];var d=e[a]||[],f=K(d.concat(b));return d.length!=f.length?c(a,f):f},setdel:function(a,b){var d=e[a]||[],f=F(d,b);return d.length!=f.length?c(a,f):f},disable:function(a){f(c.list[a],function(b){(b.S||(b.S={}))[a]=!0});return c.list[a]},unset:function(){var a=!0;f(arguments,function(b){a&=b in e;delete e[b]});return a},
find:function(a){return C(t(e),function(b){return b.match(a)})},changed:function(a,b){b||(b=a,a="__base");return c.on(a,function(a,e){var f=w(a),h=w(e.old);1==f-h?b.call(c.context,a.length?a[a.length-1]:void 0):f>h&&b.call(c.context,l.call(a).slice(h))})},sniff:function(){var a={},b=+new Date,d=function(c){a[c[0]]||console.log(+new Date-b,c)},e=function(){},f=d;c.traceList.unshift(function(a){f(a)});c.sniff=function(b){if(0<arguments.length){if(A(b))return a[b]=!a[b],"[Un]ignoring "+b;f=b?d:e;return b}return t(a)}}});
c.setAdd=c.setadd;c.setDel=c.setdel;c.isSet=c.isset;c.get=c;c.change=c.on;c.add=c.push;c.isArray=g;return c};
