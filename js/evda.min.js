function EvDa(){function n(a,c,d){var f=b[a],g,e={};b[a]=c;h(l,function(b){g=i[b][a];h(g,function(b,g){e[g]=b(c,{meta:d,old:f,current:c,key:a,remove:function(){b.rm=!0}})});h(g,function(a){a.rm&&m(a)})});k[a]=!1;return e}function s(a,c,d){function f(b){g--;e+=b===!1;g||(e||n(a,c,d),k[a]=!1)}var g=i.test[a].length,e=0;h(i.test[a],function(g){g(c,{meta:d,old:b[a],callback:f,key:a,remove:function(){m(g)}})})}function t(a){a.refs=[];o[a.ix=++u]=a}function j(a,c,b){var f={};h(p([a]),function(a){k[a]||
(k[a]=!0,f[a]=i.test[a]?s(a,c,b):n(a,c,b))});return f}function m(a){h(a.refs,function(c){var b=c[0],c=c[1];i[b][c]=_.without(i[b][c],a)});delete o[a.ix]}function v(a){var c={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];h(q(e),function(b){c[b]=function(){e[b].apply(this,a.scope.concat(_.toArray(arguments),a.meta));return c}});return c}function e(a,c){var d=arguments.length,f={};if(d==0)return[b,i];if(_.isObject(a))return h(a,function(a,b){f[b]=e(b,a)}),f;if(d==1)return a.search(/[*?]/)+1?_.select(q(b),
function(b){return b.match(a)}):b[a];f=v({scope:a});_.isFunction(c)?f.when(c):d>1&&f.run(c);return f}var h=_.each,q=_.keys,r=_.extend,p=_.flatten,b={},u=0,o={},l=["test","when","after"],i={},k={};h(l,function(a){i[a]={};e[a]=function(b,d){t(d);h(p([b]),function(b){i[a][b]=(i[a][b]||[]).concat(d);d.refs.push([a,b])});return r(e,{handle:d})}});l.shift();return r(e,{push:function(a,c){b[a]=b[a]||[];b[a].current=b[a].push(c);return j(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return j(a,
b[a])},incr:function(a){return j(a,_.isNumber(b[a])?b[a]+1:1)},decr:function(a){return j(a,b[a]-1||0)},once:function(a,b){var d=e.when(a,b);d.handle.rm=!0;return d},isset:function(a,c){if(!(a in b)&&c)return e.once(a,c);c&&c(b[a]);return a in b},firstset:isset,onset:get,run:j,emit:j,get:e,set:function(a,b){arguments.length==1&&(b=!0);return e(a,b)},unset:function(a){delete b[a]},remove:m})};
